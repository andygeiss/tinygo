// Copyright 2018 The Go Authors. All rights reserved.
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file.
//
// This file has been modified for use by the TinyGo compiler.
(()=>{const a="undefined"!=typeof process;if(a){global.require=require,global.fs=require("fs");const a=require("crypto");global.crypto={getRandomValues(c){a.randomFillSync(c)}},global.performance={now(){const[a,b]=process.hrtime();return 1e3*a+b/1e6}};const b=require("util");global.TextEncoder=b.TextEncoder,global.TextDecoder=b.TextDecoder}else{if("undefined"!=typeof window)window.global=window;else if("undefined"!=typeof self)self.global=self;else throw new Error("cannot export Go (neither window nor self is defined)");let a="";global.fs={constants:{O_WRONLY:-1,O_RDWR:-1,O_CREAT:-1,O_TRUNC:-1,O_APPEND:-1,O_EXCL:-1},writeSync(b,d){a+=c.decode(d);const e=a.lastIndexOf("\n");return-1!=e&&(console.log(a.substr(0,e)),a=a.substr(e+1)),d.length},write(a,b,c,d,e,f){if(0!==c||d!==b.length||null!==e)throw new Error("not implemented");const g=this.writeSync(a,b);f(null,g)},open(a,b,c,d){const e=new Error("not implemented");e.code="ENOSYS",d(e)},fsync(a,b){b(null)}}}const b=new TextEncoder("utf-8"),c=new TextDecoder("utf-8");var d=[];if(global.Go=class{constructor(){this._callbackTimeouts=new Map,this._nextCallbackTimeoutID=1;const a=()=>new DataView(this._inst.exports.memory.buffer),e=(b,c)=>{a().setUint32(b+0,c,!0),a().setUint32(b+4,Math.floor(c/4294967296),!0)},f=b=>{const c=a().getFloat64(b,!0);if(0!==c){if(!isNaN(c))return c;const d=a().getUint32(b,!0);return this._values[d]}},g=(b,c)=>{const d=2146959360;if("number"==typeof c)return isNaN(c)?(a().setUint32(b+4,2146959360,!0),void a().setUint32(b,0,!0)):0===c?(a().setUint32(b+4,2146959360,!0),void a().setUint32(b,1,!0)):void a().setFloat64(b,c,!0);switch(c){case void 0:return void a().setFloat64(b,0,!0);case null:return a().setUint32(b+4,d,!0),void a().setUint32(b,2,!0);case!0:return a().setUint32(b+4,d,!0),void a().setUint32(b,3,!0);case!1:return a().setUint32(b+4,d,!0),void a().setUint32(b,4,!0);}let e=this._refs.get(c);void 0===e&&(e=this._values.length,this._values.push(c),this._refs.set(c,e));let f=0;switch(typeof c){case"string":f=1;break;case"symbol":f=2;break;case"function":f=3;}a().setUint32(b+4,2146959360|f,!0),a().setUint32(b,e,!0)},h=(a,b)=>new Uint8Array(this._inst.exports.memory.buffer,a,b),i=(b,c)=>{const d=Array(c);for(let a=0;a<c;a++)d[a]=f(b+8*a);return d},j=(a,b)=>c.decode(new DataView(this._inst.exports.memory.buffer,a,b)),k=Date.now()-performance.now();this.importObject={env:{io_get_stdout:function(){return 1},resource_write:function(b,e,f){if(1==b){for(let b,g=0;g<f;g++)if(b=a().getUint8(e+g),13==b);else if(10==b){let a=c.decode(new Uint8Array(d));d=[],console.log(a)}else d.push(b);}else console.error("invalid file descriptor:",b)},"runtime.ticks":()=>k+performance.now(),"runtime.sleepTicks":a=>{setTimeout(this._inst.exports.go_scheduler,a)},"syscall/js.stringVal":(a,b,c)=>{const d=j(b,c);g(a,d)},"syscall/js.valueGet":(a,b,c,d)=>{let e=j(c,d),h=f(b),i=Reflect.get(h,e);g(a,i)},"syscall/js.valueSet":(a,b,c,d)=>{const e=f(a),g=j(b,c),h=f(d);Reflect.set(e,g,h)},"syscall/js.valueCall":(b,c,d,e,h,k,l)=>{const n=f(c),o=j(d,e),p=i(h,k,l);try{const c=Reflect.get(n,o);g(b,Reflect.apply(c,n,p)),a().setUint8(b+8,1)}catch(c){g(b,c),a().setUint8(b+8,0)}},"syscall/js.valueNew":(b,c,d,e,h)=>{const j=f(c),k=i(d,e,h);try{g(b,Reflect.construct(j,k)),a().setUint8(b+8,1)}catch(c){g(b,c),a().setUint8(b+8,0)}},"syscall/js.valuePrepareString":(a,c)=>{const d=f(c)+"",h=b.encode(d);g(a,h),e(a+8,h.length)},"syscall/js.valueLoadString":(a,b,c,d)=>{const e=f(a);h(b,c,d).set(e)}}}}async run(a){this._inst=a,this._values=[NaN,0,null,!0,!1,global,this._inst.exports.memory,this],this._refs=new Map,this._callbackShutdown=!1,this.exited=!1;for(new DataView(this._inst.exports.memory.buffer);;){const a=new Promise(a=>{this._resolveCallbackPromise=()=>{if(this.exited)throw new Error("bad callback: Go program has already exited");setTimeout(a,0)}});if(this._inst.exports.cwa_main(),this.exited)break;await a}}static _makeCallbackHelper(a,b,c){return function(){b.push({id:a,args:arguments}),c._resolveCallbackPromise()}}static _makeEventCallbackHelper(a,b,c,d){return function(e){a&&e.preventDefault(),b&&e.stopPropagation(),c&&e.stopImmediatePropagation(),d(e)}}},a){3!=process.argv.length&&(process.stderr.write("usage: go_js_wasm_exec [wasm binary] [arguments]\n"),process.exit(1));const a=new Go;WebAssembly.instantiate(fs.readFileSync(process.argv[2]),a.importObject).then(b=>(process.on("exit",b=>{0!==b||a.exited||(a._callbackShutdown=!0)}),a.run(b.instance))).catch(a=>{throw a})}})();